#include <stdio.h>
#include "ec-kcdsa.h"

void main() {
	MPZ sk;
	ECC_PARAMS curve;
	ECC_POINT public_point;

	unsigned char msg[] = 
	{ 
		0x54, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x73, 0x61, 0x6D, 0x70, 0x6C, 0x65,
		0x20, 0x6D, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65, 0x20, 0x66, 0x6F, 0x72, 0x20, 0x45, 0x43, 0x2D,
	    0x4B, 0x43, 0x44, 0x53, 0x41, 0x20, 0x69, 0x6D, 0x70, 0x6C, 0x65, 0x6D, 0x65, 0x6E, 0x74, 0x61,
	    0x74, 0x69, 0x6F, 0x6E, 0x20, 0x76, 0x61, 0x6C, 0x69, 0x64, 0x61, 0x74, 0x69, 0x6F, 0x6E, 0x2E 
	};
	int msgLen = 64;
	unsigned char user_provided_random_input[] =
	{ 
		0x73, 0x61, 0x6C, 0x64, 0x6A, 0x66, 0x61, 0x77, 0x70, 0x33, 0x39, 0x39, 0x75, 0x33, 0x37, 0x34,
		0x72, 0x30, 0x39, 0x38, 0x75, 0x39, 0x38, 0x5E, 0x25, 0x5E, 0x25, 0x68, 0x6B, 0x72, 0x67, 0x6E,
		0x3B, 0x6C, 0x77, 0x6B, 0x72, 0x70, 0x34, 0x37, 0x74, 0x39, 0x33, 0x63, 0x25, 0x24, 0x38, 0x39,
		0x34, 0x33, 0x39, 0x38, 0x35, 0x39, 0x6B, 0x6A, 0x64, 0x6D, 0x6E, 0x76, 0x63, 0x6D, 0x20, 0x63,
		0x76, 0x6B, 0x20, 0x6F, 0x34, 0x75, 0x30, 0x39, 0x72, 0x20, 0x34, 0x6A, 0x20, 0x6F, 0x6A, 0x32,
		0x6F, 0x75, 0x74, 0x32, 0x30, 0x39, 0x78, 0x66, 0x71, 0x77, 0x3B, 0x6C, 0x2A, 0x26, 0x21, 0x5E,
		0x23, 0x40, 0x55, 0x23, 0x2A, 0x23, 0x24, 0x29, 0x28, 0x23, 0x20, 0x7A, 0x20, 0x78, 0x6F, 0x39,
		0x35, 0x37, 0x74, 0x63, 0x2D, 0x39, 0x35, 0x20, 0x35, 0x20, 0x76, 0x35, 0x6F, 0x69, 0x75, 0x76,
		0x39, 0x38, 0x37, 0x36, 0x20, 0x36, 0x20, 0x76, 0x6A, 0x20, 0x6F, 0x35, 0x69, 0x75, 0x76, 0x2D,
		0x30, 0x35, 0x33, 0x2C, 0x6D, 0x63, 0x76, 0x6C, 0x72, 0x6B, 0x66, 0x77, 0x6F, 0x72, 0x65, 0x74 
	};
	int user_provided_random_input_Len = 160;
	unsigned char sig[72];

	ECC_init_params(ECC_PRIME_FIELD, &curve, SECP224r);

	ECC_set_params(SECP224r, &curve);

	Private_Key_generator(&sk, curve, SECP224r, SHA224, user_provided_random_input, user_provided_random_input_Len);

	Public_Key_generator(&public_point, sk.dat, curve);

	EC_KCDSA_sign(public_point, curve, sk.dat, SECP224r, SHA224, msg, msgLen, sig);

	printf("R = ");
	for (int i = 0; i < 28; i++) {
		printf("%02X ", sig[i]);
	}
	printf("\n");
	printf("S = ");
	for (int i = 28; i < 56; i++) {
		printf("%02X ", sig[i]);
	}
	printf("\n");

	int ret = EC_KCDSA_verify(public_point, sig, curve, SECP224r, SHA224, msg, msgLen);
	printf("verify :");
	if (ret == 0)
		printf("Success\n");
	else
		printf("Fail\n");
}
